<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scoresheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* --- Styles unchanged from your version --- */
body { font-family: Arial, sans-serif; font-size: 18px; background-color: #000; color: #fff; }
.row { display: flex; justify-content: center; gap: 40px; margin-top: 40px; }
.block { text-align: center; }
.roster-box { text-align: left; width:180px; margin-top: 10px; padding: 8px 10px; border: 1px solid #000; min-width:1px; min-height:1px; font-size:22px; white-space:pre-line; background-color:#000; color:#fff; }
label { font-weight:bold; color:#fff; font-size:20px; }
.playerName { cursor:pointer; padding:2px 0; }
.playerName:hover { background-color:#333; }
h3 { margin:0 0 8px 0; color:#fff; }
input[type="number"] { width:35px; padding:4px 6px; font-size:20px; background-color:#fff; color:#000; border:1px solid #fff; border-radius:4px; margin-bottom:6px; text-align:center; }
.stat-row { display:flex; flex-direction:column; align-items:center; margin-bottom:12px; }
.stat-row label { width:auto; text-align:center; margin-bottom:4px; }
.center-label { display:flex; flex-direction:column; align-items:center; }
select, input, button { font-size:inherit; font-family:inherit; }
.form-wrapper {
    width: 100%; /* Spans full width */
    margin: 10px 0; /* 0 Removes side margins */
    padding: 2px;
    border: 4px solid #1e90ff;
    border-radius: 0; /* Optional: remove radius for true edge-to-edge look */
    box-sizing: border-box; /* Crucial: includes padding/border in 100% width */
}

.playerName {
  display: flex;           /* allow name and HC to be on same line */
  justify-content: space-between; /* push HC to right */
  padding: 2px 0;
  cursor: pointer;
}

.playerName span.hc {
  color: #fff;             /* lighter color for HC */
  -weight: normal;
}
  #lagWinnerHeader,
#lagLoserHeader {
    font-size: 18px;
    margin-bottom: 10px;
}
/* MOBILE STYLES */
@media (max-width:600px) {
.row { flex-direction:column; gap:20px; margin-top:20px; align-items:center; text-align:center; }
.form-wrapper { margin:5px; padding:8px; }
.roster-box { 
    text-align: left; 
    width: 90%;       /* take up most of the screen on mobile */
    max-width: 300px; /* optional: donâ€™t let it get too wide on large phones */
    margin: 0 auto;   /* center it horizontally */
  }
}
.lag-row { flex-direction:column; gap:10px; width:100%; margin-top:20px; align-items:center; text-align:center; }
.stat-row { display:flex; flex-direction:column; align-items:center; margin-bottom:12px; }
.stat-row label { width:auto; text-align:center; margin-bottom:4px; }
.player-stats-container { position:relative; display:flex; justify-content:center; gap:60px; }
.player-stats-container::after { content:""; position:absolute; top:0; bottom:0; left:50%; transform:translateX(-50%); width:2px; background-color:#fff; opacity:0.7; pointer-events:none; }
.back-button { display: block; margin: 30px auto 0 auto; padding: 8px 16px; background-color: #1e90ff; color: #fff; border-radius: 6px; text-decoration: none; font-size: 18px; text-align: center; }

</style>
</head>
<body>
<div class="form-wrapper">

<div class="row">
    <div class="block">
        <select id="team">
            <option value="">-- Select Home Team --</option>
            <option>Halfway Crooks</option>
            <option>Haters Welcome</option>
            <option>Lynn's Amigos</option>
            <option>Rackless Behavior</option>
            <option>Dirty Ballers</option>
            <option>8 on Break</option>
            <option>Five Amigos</option>
            <option>Frank's Pizza</option>
            <option>Killer Instinct</option>
            <option>Pete's Bunch</option>
        </select>
        <div id="teamRoster" class="roster-box"></div>
    </div>
    <div class="block">
        <select id="opponent">
            <option value="">-- Select Away Team --</option>
            <option>Halfway Crooks</option>
            <option>Haters Welcome</option>
            <option>Lynn's Amigos</option>
            <option>Rackless Behavior</option>
            <option>Dirty Ballers</option>
            <option>8 on Break</option>
            <option>Five Amigos</option>
            <option>Frank's Pizza</option>
            <option>Killer Instinct</option>
            <option>Pete's Bunch</option>
        </select>
        <div id="opponentRoster" class="roster-box"></div>
    </div>
</div>

<div class="lag-row" style="display:flex;justify-content:center;gap:40px;margin-top:30px;">
    <div class="block center-label">
        <label>Lag Winner</label>
        <input id="lagWinner" readonly style="width:160px; text-align:center;">
    </div>
    <div class="block center-label">
        <label>Lag Loser</label>
        <input id="lagLoser" readonly style="width:160px; text-align:center;">
    </div>
</div>

<div style="text-align:center;margin-top:30px;">
    <label>Innings</label><br>
    <div class="innings-wrapper">
        <button type="button" class="btn-minus" onclick="changeInnings(-1)">âˆ’</button>
        <input type="number" id="matchInnings" value="0" min="0">
        <button type="button" class="btn-plus" onclick="changeInnings(1)">+</button>
    </div>
</div>


<div class="player-stats-container" style="margin-top:40px;">
    <div class="block">
        <h3 id="lagWinnerHeader">Lag Winner</h3>
        <div class="stat-row">
            <label>HC</label>
            <div class="innings-wrapper">
                <button onclick="changePAHC(-1)">âˆ’</button>
                <input id="pA_hc" type="number" value="0" min="0">
                <button onclick="changePAHC(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>Wins</label>
            <div class="innings-wrapper">
                <button onclick="changeWinsA(-1)">âˆ’</button>
                <input id="pA_wins" type="number" value="0" min="0">
                <button onclick="changeWinsA(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>Safeties</label>
            <div class="innings-wrapper">
                <button onclick="changePASafeties(-1)">âˆ’</button>
                <input id="pA_safeties" type="number" value="0" min="0">
                <button onclick="changePASafeties(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>8B</label>
            <div class="innings-wrapper">
                <button onclick="changePA8B(-1)">âˆ’</button>
                <input id="pA_b8" type="number" value="0" min="0">
                <button onclick="changePA8B(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>B+R</label>
            <div class="innings-wrapper">
                <button onclick="changePABR(-1)">âˆ’</button>
                <input id="pA_br" type="number" value="0" min="0">
                <button onclick="changePABR(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>E8</label>
            <div class="innings-wrapper">
                <button onclick="changePAE8(-1)">âˆ’</button>
                <input id="pA_e8" type="number" value="0" min="0">
                <button onclick="changePAE8(1)">+</button>
            </div>
        </div>
    </div>

    <div class="block">
        <h3 id="lagLoserHeader">Lag Loser</h3>
        <div class="stat-row">
            <label>HC</label>
            <div class="innings-wrapper">
                <button onclick="changePBHC(-1)">âˆ’</button>
                <input id="pB_hc" type="number" value="0" min="0">
                <button onclick="changePBHC(1)">+</button>
            </div>
        </div>
      <div class="stat-row">
            <label>Wins</label>
            <div class="innings-wrapper">
                <button onclick="changeWinsB(-1)">âˆ’</button>
                <input id="pB_wins" type="number" value="0" min="0">
                <button onclick="changeWinsB(1)">+</button>
               </div>
        </div>
        <div class="stat-row">
            <label>Safeties</label>
            <div class="innings-wrapper">
                <button onclick="changePBsafeties(-1)">âˆ’</button>
                <input id="pB_safeties" type="number" value="0" min="0">
                <button onclick="changePBsafeties(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>8B</label>
            <div class="innings-wrapper">
                <button onclick="changePB8B(-1)">âˆ’</button>
                <input id="pB_b8" type="number" value="0" min="0">
                <button onclick="changePB8B(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>B+R</label>
            <div class="innings-wrapper">
                <button onclick="changePBBR(-1)">âˆ’</button>
                <input id="pB_br" type="number" value="0" min="0">
                <button onclick="changePBBR(1)">+</button>
            </div>
        </div>
      <div class="stat-row">
            <label>E8</label>
            <div class="innings-wrapper">
                <button onclick="changePBE8(-1)">âˆ’</button>
                <input id="pB_e8" type="number" value="0" min="0">
                <button onclick="changePBE8(1)">+</button>
            </div>
        </div>
    </div>
</div>

<div style="text-align:center;margin-top:30px;">
    <label>Match Winner</label><br>
   <input id="matchWinner" readonly style="text-align:center; width:160px;">
</div>

<div style="text-align:center;margin-top:30px;">
    <button id="submitMatch" style="display:none;">Submit Match</button> 
</div>

<script>
// --- JavaScript to populate rosters, lag, stats, and submit ---

const rosters = {
    "Halfway Crooks":["Dan Foster","Tony Perelli","Don Young","Don Rak","Yani Marinopoulos","Brooke Bridges","Jeremie Ketner","Tony Guthrie"],
    "Haters Welcome":["Randy Rycraft","Joe Neal","Jennifer Wagner","Jim Czenk","Phil Nelson","Pam Neal","Greg Wood","Brett Boger"],
    "Lynn's Amigos":["Francisco Ibarra","Noe CastaÃ±a","Luis Asavedo","Rico Urvina","Tomas Ramirez","Enrique Meza"],
    "Rackless Behavior":["Jim Nevin","Larry Casper","Harnaik Lal","Freddy Izguerra","Tom Nevin","Doug Misner","Joe Crutchfield"],
    "Dirty Ballers":["Rocky Oiler Sr.","Kevin Pattenaude","Ron Gonzalez","Javier Mauricio","Peggy Wood","Joey Sanchez","John Schoiber"],
    "8 on Break":["Doc Halek","Juergen Jackert","Danny Plowman","John Amrein","Kevin Ward","Shawn Mcbride","Don Murphy","Kenny Esposito"],
    "Five Amigos":["Francisco Tinajero","Sergio Sanchez","Mario Orenday","Felipe Ochoa","Jeronimo Ramirez","Kevin Joyner","Tony Perez"],
    "Frank's Pizza":["Jose Gonzalez"],
    "Killer Instinct":["Mike Uhlean","Doug Andrus","Jim Berger","Shawn Vitolka","Mike Zbonski Jr.","Luke Valenzuela","Samantha Kommenich"],
    "Pete's Bunch":["Tom Schroeder","Chuck Harding","Dan Schroeder","Rob Zwart","Pete Steele","Buster Fuller"]
};

const playerData = {
    "Dan Foster":3,"Tony Perelli":5,"Don Young":3,"Don Rak":6,"Yani Marinopoulos":5,"Brooke Bridges":2,
    "Jeremie Ketner":4,"Tony Guthrie":6,"Randy Rycraft":4,"Joe Neal":4,"Jennifer Wagner":3,"Jim Czenk":2,
    "Phil Nelson":2,"Pam Neal":2,"Greg Wood":4,"Brett Boger":5,"Francisco Ibarra":2,"Noe CastaÃ±a":2,
    "Luis Asavedo":2,"Rico Urvina":3,"Tomas Ramirez":4,"Enrique Meza":2,"Jim Nevin":4,"Larry Casper":3,
    "Harnaik Lal":4,"Freddy Izguerra":5,"Joe Crutchfield":3,"Tom Nevin":3,"Doug Misner":4,"Rocky Oiler Sr.":3,
    "Kevin Pattenaude":3,"Ron Gonzalez":2,"Javier Mauricio":4,"Peggy Wood":2,"Joey Sanchez":4,
    "John Schoiber":2,"Doc Halek":4,"Juergen Jackert":4,"Danny Plowman":5,"John Amrein":3,
    "Kevin Ward":2,"Shawn Mcbride":2,"Don Murphy":4,"Kenny Esposito":3,"Francisco Tinajero":4,
    "Sergio Sanchez":5,"Mario Orenday":4,"Felipe Ochoa":3,"Jeronimo Ramirez":3,"Kevin Joyner":5,
    "Tony Perez":4,"Jose Gonzalez":3,"Mike Uhlean":5,"Doug Andrus":4,"Jim Berger":4,
    "Shawn Vitolka":5,"Mike Zbonski Jr.":3,"Luke Valenzuela":6,"Samantha Kommenich":2,
    "Tom Schroeder":4,"Chuck Harding":3,"Dan Schroeder":5,"Rob Zwart":4,"Pete Steele":2,"Buster Fuller":3
};

// Populate roster when team selects
function updateRoster(sel, div){
    div.innerHTML = (rosters[sel.value]||[]).map(p => {
        const hc = playerData[p] || 0; // get the player's HC
        return `<div class="playerName" data-p="${p}">
                    <span class="name">${p}</span>
                    <span class="hc">${hc}</span>
                </div>`;
    }).join("");
}

document.getElementById("team").addEventListener("change", ()=>updateRoster(team,teamRoster));
document.getElementById("opponent").addEventListener("change", ()=>updateRoster(opponent,opponentRoster));

let flip = false;

document.addEventListener("click", e => {
    const playerDiv = e.target.closest(".playerName");
    if (!playerDiv) return;

    const name = playerDiv.dataset.p;
    const hc = playerData[name] || 0;

    if (!flip) {
        lagWinner.value = name;
        pA_hc.value = hc;
        document.getElementById("lagWinnerHeader").textContent = name;
    } else {
        lagLoser.value = name;
        pB_hc.value = hc;
        document.getElementById("lagLoserHeader").textContent = name;
    }

    flip = !flip;
});


// Stat increment/decrement functions
function changeInnings(amount){ let input = matchInnings; input.value = Math.max(0,(parseInt(input.value)||0)+amount); }
function changeWinsA(amount){ let input=pA_wins; input.value=Math.max(0,(parseInt(input.value)||0)+amount); updateMatchWinner(); }
function changePALosses(amount){ let input=pA_losses; input.value=Math.max(0,(parseInt(input.value)||0)+amount); updateMatchWinner(); }
function changePASafeties(amount){ let input=pA_safeties; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
function changePA8B(amount){ let input=pA_b8; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
function changePABR(amount){ let input=pA_br; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
function changePAHC(amount){ let input=pA_hc; input.value=Math.max(0,(parseInt(input.value)||0)+amount); updateMatchWinner(); }
function changePBHC(amount){ let input=pB_hc; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
function changePBsafeties(amount){ let input=pB_safeties; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
function changePB8B(amount){ let input=pB_b8; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
function changePBBR(amount){ let input=pB_br; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
function changePAE8(amount){ let input=pA_e8; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
function changeWinsB(amount){ let input=pB_wins; input.value=Math.max(0,(parseInt(input.value)||0)+amount); updateMatchWinner(); }
function changePBE8(amount){ let input=pB_e8; input.value=Math.max(0,(parseInt(input.value)||0)+amount); }
// Match winner logic
function updateMatchWinner(){
    const aWins = parseInt(pA_wins.value)||0;
    const aLoss = parseInt(pB_wins.value)||0;
    const aHC = parseInt(pA_hc.value)||0;
    const bHC = parseInt(pB_hc.value)||0;

    if(aWins === aHC && aHC > 0){
        matchWinner.value = lagWinner.value;
    } else if(aLoss === bHC && bHC > 0){
        matchWinner.value = lagLoser.value;
    } else {
        matchWinner.value = "";
    }

    // ðŸ”’ Show submit button ONLY when matchWinner exists
    submitMatch.style.display = matchWinner.value ? "inline-block" : "none";
}

// Submit to Google Sheets
submitMatch.onclick = () => {

    // Disable button immediately
    submitMatch.disabled = true;
    submitMatch.style.opacity = "0.5";
    submitMatch.style.cursor = "not-allowed";

    // Show waiting popup
    alert("Please wait while your results are submitted...");

    const data = {
        team: team.value,
        opponent: opponent.value,
        lagWinner: lagWinner.value,
        lagLoser: lagLoser.value,
        matchInnings: matchInnings.value,
        pA: { 
            handicap: pA_hc.value, 
            wins: pA_wins.value, 
            safeties: pA_safeties.value, 
            b8: pA_b8.value, 
            br: pA_br.value, 
            e8: pA_e8.value 
        },
        pB: { 
            handicap: pB_hc.value, 
            wins: pB_wins.value, 
            safeties: pB_safeties.value, 
            b8: pB_b8.value, 
            br: pB_br.value, 
            e8: pB_e8.value 
        },
        matchWinner: matchWinner.value
    };

    fetch("https://script.google.com/macros/s/AKfycbyeYfnQiubM6MJ7tJ3KHbuD9EBGJ6JyggjT9RIuswQ6EWe0x-mOIsAa50akBuC_gNPv/exec", {
        method: "POST",
        body: JSON.stringify(data)
    })
    .then(() => {
        document.querySelectorAll("input").forEach(i => i.value = "");
        alert("Match submitted successfully. You may now enter the next match.");

        // Re-enable button
        submitMatch.disabled = false;
        submitMatch.style.opacity = "1";
        submitMatch.style.cursor = "pointer";
    })
    .catch(() => {
        alert("There was an error submitting the match. Please try again.");

        // Re-enable button on error
        submitMatch.disabled = false;
        submitMatch.style.opacity = "1";
        submitMatch.style.cursor = "pointer";
    });
    };
const FORM_KEY = "scoresheetData";

/* SAVE FORM STATE */
function saveScoresheet() {
    const ids = [
        "team","opponent","lagWinner","lagLoser","matchInnings","matchWinner",
        "pA_hc","pA_wins","pA_safeties","pA_b8","pA_br","pA_e8",
        "pB_hc","pB_wins","pB_safeties","pB_b8","pB_br","pB_e8"
    ];

    const data = {};
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) data[id] = el.value;
    });

    localStorage.setItem(FORM_KEY, JSON.stringify(data));
}

/* LOAD FORM STATE */
function loadScoresheet() {
    const data = JSON.parse(localStorage.getItem(FORM_KEY));
    if (!data) return;

    Object.keys(data).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = data[id];
    });

    updateRoster(team, teamRoster);
    updateRoster(opponent, opponentRoster);

    lagWinnerHeader.textContent = lagWinner.value || "Lag Winner";
    lagLoserHeader.textContent = lagLoser.value || "Lag Loser";

    submitMatch.style.display = matchWinner.value ? "inline-block" : "none";
}

/* AUTO SAVE */
document.addEventListener("input", saveScoresheet);
document.addEventListener("click", saveScoresheet);

/* LOAD ON PAGE OPEN */
window.addEventListener("DOMContentLoaded", loadScoresheet);

/* CLEAR AFTER SUBMIT */
submitMatch.addEventListener("click", () => {
    setTimeout(() => localStorage.removeItem(FORM_KEY), 1000);
});
    /* ==============================
   SCORESHEET TRANSFER (OPTION 1)
   ============================== */

<!-- QR Code transfer buttons and container -->
<div style="text-align:center; margin-top:20px;">
    <button type="button" onclick="generateQRCode()" style="margin-bottom:12px;">
        Export Scoresheet as QR
    </button>
    <br>
    <input type="file" id="qrFileInput" accept="image/*" style="margin-top:12px;">
    <br>
    <button type="button" onclick="scanQRCode()">
        Import Scoresheet from QR
    </button>
    <div id="qrContainer" style="margin-top:12px;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
<script>
<!-- QR Code export and camera scanning -->
<div style="text-align:center; margin-top:20px;">
    <button type="button" onclick="generateQRCode()" style="margin-bottom:12px;">
        Export Scoresheet as QR
    </button>
    <br>
    <video id="qrVideo" style="width:250px; height:250px; margin-top:12px; border:1px solid #fff;"></video>
    <br>
    <button type="button" onclick="startScanner()" style="margin-top:12px;">
        Scan Scoresheet QR
    </button>
    <div id="qrContainer" style="margin-top:12px;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
<script>
/* ==============================
   QR CODE EXPORT
   ============================== */
function generateQRCode() {
    const data = localStorage.getItem("scoresheetData");
    if (!data) {
        alert("No scoresheet data to export.");
        return;
    }

    const container = document.getElementById("qrContainer");
    container.innerHTML = ""; // clear previous QR
    QRCode.toCanvas(data, { width: 200 }, function(err, canvas) {
        if (err) { console.error(err); alert("Failed to generate QR code."); return; }
        container.appendChild(canvas);
    });
}

/* ==============================
   CAMERA-BASED QR SCANNER
   ============================== */
let videoStream;
function startScanner() {
    const video = document.getElementById("qrVideo");
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("Camera access not supported on this device.");
        return;
    }

    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
    .then(stream => {
        videoStream = stream;
        video.srcObject = stream;
        video.setAttribute("playsinline", true); // iOS
        video.play();
        requestAnimationFrame(scanFrame);
    })
    .catch(err => {
        alert("Camera access denied or unavailable.");
        console.error(err);
    });
}

function scanFrame() {
    const video = document.getElementById("qrVideo");
    if (video.readyState !== video.HAVE_ENOUGH_DATA) {
        requestAnimationFrame(scanFrame);
        return;
    }

    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const code = jsQR(imageData.data, imageData.width, imageData.height);

    if (code && code.data) {
        try {
            JSON.parse(code.data); // validate JSON
            localStorage.setItem("scoresheetData", code.data);
            alert("Scoresheet imported successfully! Reloading...");
            stopScanner();
            location.reload();
            return;
        } catch (e) {
            alert("Invalid scoresheet QR code.");
        }
    }
    requestAnimationFrame(scanFrame);
}

function stopScanner() {
    const video = document.getElementById("qrVideo");
    if (videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
        videoStream = null;
    }
    video.srcObject = null;
}
</script>

    <div style="text-align:center; margin-top:20px;">
    <button type="button" onclick="exportScoresheet()" style="margin-bottom:12px;">
        Transfer Scoresheet
    </button>
    <br>
    <button type="button" onclick="importScoresheet()">
        Import Scoresheet
    </button>
</div>

    <a class="back-button" href="index.html">Back to Main Menu</a>
</div>
</body>
</html>
