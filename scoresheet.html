<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scoresheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="scoresheetrosters.js"></script>
    <script src="scoresheetinfo.js"></script>
<style>
/* --- Styles unchanged from your version --- */
body { font-family: Arial, sans-serif; font-size: 18px; background-color: #000; color: #fff; }
.row { display: flex; justify-content: center; gap: 40px; margin-top: 40px;font-size:22px; }
.block { text-align: center; }
.roster-box { text-align: left; width:180px; margin-top: 10px; padding: 8px 10px; border: 1px solid #000; min-width:1px; min-height:1px; font-size:22px; white-space:pre-line; background-color:#000; color:#fff; }
label { font-weight:bold; color:#fff; font-size:20px; }
.playerName { cursor:pointer; padding:2px 0; }
.playerName:hover { background-color:#333; }
h3 { margin:0 0 8px 0; color:#fff; }
input[type="number"] { width:35px; padding:4px 6px; font-size:20px; background-color:#fff; color:#000; border:1px solid #fff; border-radius:4px; margin-bottom:6px; text-align:center; }
.stat-row { display:flex; flex-direction:column; align-items:center; margin-bottom:12px; }
.stat-row label { width:auto; text-align:center; margin-bottom:4px; }
.center-label { display:flex; flex-direction:column; align-items:center; }
select, input, button { font-size:inherit; font-family:inherit; }
.form-wrapper {
    width: 100%; /* Spans full width */
    padding: 2px;
    border: 4px solid #1e90ff;
    border-radius: 0; /* Optional: remove radius for true edge-to-edge look */
    box-sizing: border-box; /* Crucial: includes padding/border in 100% width */
}

.playerName {
  display: flex;           /* allow name and HC to be on same line */
  justify-content: space-between; /* push HC to right */
  padding: 2px 0;
  cursor: pointer;
}

.playerName span.hc {
  color: #fff;             /* lighter color for HC */
  -weight: normal;
}
  #lagWinnerHeader,
#lagLoserHeader {
    font-size: 18px;
    margin-bottom: 10px;
}
    .button-row {
    display: flex;         /* Align buttons in a row */
    justify-content: space-between; /* Evenly space them */
    gap: 5px;              /* Tiny gap between buttons */
    width: 100%;           /* Fill the container */
    margin-top: 20px;
    box-sizing: border-box;
}

.button-row button {
    flex: 1;               /* Forces all 4 buttons to be exactly the same width */
    height: 40px;
    font-size: 18px;       /* Slightly smaller to ensure "Transfer" fits on small phones */
    padding: 0;            /* Remove internal padding to save space */
    text-align: center;
    white-space: nowrap;   /* Prevents text from wrapping to a second line */
}
/* MOBILE STYLES */
@media (max-width:600px) {
.row { flex-direction:column; gap:20px; margin-top:20px; align-items:center; text-align:center; }
.form-wrapper { margin:5px; padding:8px; }
.roster-box { 
    text-align: left; 
    width: 90%;       /* take up most of the screen on mobile */
    max-width: 300px; /* optional: don’t let it get too wide on large phones */
    margin: 0 auto;   /* center it horizontally */
  }
}
.button-row button {font-size: 14px;}
.lag-row {gap:10px; width:100%; margin-top:20px; align-items:center; text-align:center;display: none;}
.stat-row { display:flex; flex-direction:column; align-items:center; margin-bottom:12px; }
.stat-row label { width:auto; text-align:center; margin-bottom:4px; }
.player-stats-container { position:relative; display:flex; justify-content:center; gap:60px; }
.player-stats-container::after { content:""; position:absolute; top:0; bottom:0; left:50%; transform:translateX(-50%); width:2px; background-color:#fff; opacity:0.7; pointer-events:none; }
.back-button { display: block; margin: 15px auto 0 auto; background-color: #1e90ff; color: #fff; border-radius: 6px; text-decoration: none; font-size: 24px; text-align: center; }
 /* Floating timer box */
#timerBox {
  display: none;
  width:125px;
  top: 50%;
  right: calc(50% - 10px); /* ← nudge RIGHT */
  background: #000;
  color: #fff;
  border-radius: 8px;
  border-color: #4af;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  z-index: 1000;
}





  #timerValue {
    font-size: 1.5em;
    font-weight: bold;
  }
  .closeBtn {
    background: crimson;
    border: none;
    color: white;
    margin-left: 10px;
    border-radius: 4px;
    cursor: pointer;
  }
  .startBtn {
    font-size: 1em;
    cursor: pointer;
  }
</style>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
</head>
<body>
<div class="form-wrapper">

<div class="row">
    <div class="block">
        <select id="team">
            <option value="">-- Select Home Team --</option>
            <option>Halfway Crooks</option>
            <option>Haters Welcome</option>
            <option>Lynn's Amigos</option>
            <option>Rackless Behavior</option>
            <option>Dirty Ballers</option>
            <option>8 on Break</option>
            <option>Five Amigos</option>
            <option>Frank's Pizza</option>
            <option>Killer Instinct</option>
            <option>Pete's Bunch</option>
        </select>
        <div id="teamRoster" class="roster-box"></div>
    </div>
    <div class="block">
        <select id="opponent">
            <option value="">-- Select Away Team --</option>
            <option>Halfway Crooks</option>
            <option>Haters Welcome</option>
            <option>Lynn's Amigos</option>
            <option>Rackless Behavior</option>
            <option>Dirty Ballers</option>
            <option>8 on Break</option>
            <option>Five Amigos</option>
            <option>Frank's Pizza</option>
            <option>Killer Instinct</option>
            <option>Pete's Bunch</option>
        </select>
        <div id="opponentRoster" class="roster-box"></div>
    </div>
</div>

<div class="lag-row" style="display:none;justify-content:center;gap:40px;margin-top:30px;">
    <div class="block center-label">
        <label>Lag Winner</label>
        <input id="lagWinner" readonly style="width:135px; text-align:center;">
    </div>
    <div class="block center-label">
        <label>Lag Loser</label>
        <input id="lagLoser" readonly style="width:135px; text-align:center;">
    </div>
</div>

<div style="text-align:center;margin-top:30px;">
    <label>Innings</label><br>
    <div class="innings-wrapper">
        <button type="button" class="btn-minus" onclick="changeInnings(-1)">−</button>
        <input type="number" id="matchInnings" value="0" min="0">
        <button type="button" class="btn-plus" onclick="changeInnings(1)">+</button>
    </div>
</div>


<div class="player-stats-container" style="margin-top:40px;">
    <div class="block">
        <h3 id="lagWinnerHeader">Lag Winner</h3>
        <div class="stat-row">
            <label>HC</label>
            <div class="innings-wrapper">
                <button onclick="changePAHC(-1)">−</button>
                <input id="pA_hc" type="number" value="0" min="0">
                <button onclick="changePAHC(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>Wins</label>
            <div class="innings-wrapper">
                <button onclick="changeWinsA(-1)">−</button>
                <input id="pA_wins" type="number" value="0" min="0">
                <button onclick="changeWinsA(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>Safeties</label>
            <div class="innings-wrapper">
                <button onclick="changePASafeties(-1)">−</button>
                <input id="pA_safeties" type="number" value="0" min="0">
                <button onclick="changePASafeties(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>8B</label>
            <div class="innings-wrapper">
                <button onclick="changePA8B(-1)">−</button>
                <input id="pA_b8" type="number" value="0" min="0">
                <button onclick="changePA8B(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>B+R</label>
            <div class="innings-wrapper">
                <button onclick="changePABR(-1)">−</button>
                <input id="pA_br" type="number" value="0" min="0">
                <button onclick="changePABR(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>E8</label>
            <div class="innings-wrapper">
                <button onclick="changePAE8(-1)">−</button>
                <input id="pA_e8" type="number" value="0" min="0">
                <button onclick="changePAE8(1)">+</button>
            </div>
        </div>
                 <div class="stat-row"><label>Coach</label><input type="checkbox" id="pA_coach">
</div>
    </div>

    <div class="block">
        <h3 id="lagLoserHeader">Lag Loser</h3>
        <div class="stat-row">
            <label>HC</label>
            <div class="innings-wrapper">
                <button onclick="changePBHC(-1)">−</button>
                <input id="pB_hc" type="number" value="0" min="0">
                <button onclick="changePBHC(1)">+</button>
            </div>
        </div>
      <div class="stat-row">
            <label>Wins</label>
            <div class="innings-wrapper">
                <button onclick="changeWinsB(-1)">−</button>
                <input id="pB_wins" type="number" value="0" min="0">
                <button onclick="changeWinsB(1)">+</button>
               </div>
        </div>
        <div class="stat-row">
            <label>Safeties</label>
            <div class="innings-wrapper">
                <button onclick="changePBsafeties(-1)">−</button>
                <input id="pB_safeties" type="number" value="0" min="0">
                <button onclick="changePBsafeties(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>8B</label>
            <div class="innings-wrapper">
                <button onclick="changePB8B(-1)">−</button>
                <input id="pB_b8" type="number" value="0" min="0">
                <button onclick="changePB8B(1)">+</button>
            </div>
        </div>
        <div class="stat-row">
            <label>B+R</label>
            <div class="innings-wrapper">
                <button onclick="changePBBR(-1)">−</button>
                <input id="pB_br" type="number" value="0" min="0">
                <button onclick="changePBBR(1)">+</button>
            </div>
        </div>
              <div class="stat-row">
            <label>E8</label>
            <div class="innings-wrapper">
                <button onclick="changePBE8(-1)">−</button>
                <input id="pB_e8" type="number" value="0" min="0">
                <button onclick="changePBE8(1)">+</button>
            </div>
        </div>
        <div class="stat-row"><label>Coach</label><input type="checkbox" id="pB_coach"></div>
    </div>
</div>
    <div style="text-align:center;padding-top:20px;;">
    <button id="submitMatch" style="display:none;background-color:#00FF00;width:200px;height:55px;border-radius: 6px;color: #000;font-weight:bold;font-size:24px;">Submit Match</button> 
</div>
<div style="text-align:center; padding-top:20px; font-size:20px;">
    <label style="display:block; margin-bottom:10px;">Match Winner</label>
    <input id="matchWinner" readonly 
           style="display: inline-block;
                  box-sizing: border-box; 
                  text-align: center; 
                  background-color: #000; 
                  color: #00ff00; 
                  font-size: 20px; 
                  border: 1px solid #000;
                  width: 180px; 
                  height: 40px; 
                  vertical-align: middle; 
                  margin: 0 auto;">
</div>
<div style="margin-top:20px;border-radius:8px;">

    <div id="teamScoreDisplay" style="text-align:center; font-size:28px; font-weight:bold; margin-bottom:10px; color:#1e90ff;">Match Score: <span id="homeScore">0</span> - <span id="awayScore">0</span>
</div>

  <div class="button-row">
    <button type="button" onclick="exportScoresheet()">Transfer</button>
    <button type="button" onclick="toggleNotes()">Notes</button>
    <button type="button" class="startBtn" onclick="startTimer()">Timer</button>
    <button type="button" onclick="showHistory()">History</button>
</div>
    
</div>
  <div id="timerBox">
    <span id="timerValue">0</span> sec

    <button class="closeBtn" onclick="closeTimer()">X</button>
  </div>

<div id="notesContainer"
     style="display:none; text-align:center; margin-top:12px;">
  <textarea
  id="matchNotes"
  style="width:60%; max-width:500px; height:70px; font-size:16px; padding:8px;"
>-</textarea>
</div>
</div>

    <a class="back-button" style= "height:30px;"href="index.html">Main Menu</a>
</div>
    <!-- QR Code Popup -->
<div id="qrModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999;">
  <div style="background:#fff; padding:20px; border-radius:8px; position:relative; max-width:90%; max-height:90%; overflow:auto;">
    <h3 style="text-align:center;color:#000;">Scan QR to Transfer</h3>
    <div id="qrcode"></div>
    <button onclick="closeQRModal()" style="margin-top:10px; padding:8px 16px; font-size:16px;">Close</button>
  </div>
</div>
    <script>
let isLoading = false;
const FORM_KEY = "scoresheetData";
let scores = JSON.parse(localStorage.getItem("teamMatchScores")) || { home: 0, away: 0 };
let flip = false;

// 1. Populate roster when team selects
function updateRoster(sel, div) {
    if (!sel.value) {
        div.innerHTML = "";
        return;
    }
    // Accessing global variables from scoresheetinfo.js and scoresheetrosters.js
    div.innerHTML = (scoresheetinfo[sel.value] || []).map(p => {
        const hc = scoresheetrosters[p] || 0;
        return `<div class="playerName" data-p="${p}">
                    <span class="name">${p}</span>
                    <span class="hc">${hc}</span>
                </div>`;
    }).join("");
}

// 2. Event Listeners for Team Selection
document.getElementById("team").addEventListener("change", function() {
    updateRoster(this, document.getElementById("teamRoster"));
});
document.getElementById("opponent").addEventListener("change", function() {
    updateRoster(this, document.getElementById("opponentRoster"));
});

// 3. Player Selection Logic (Lag Winner/Loser)
document.addEventListener("click", e => {
    const playerDiv = e.target.closest(".playerName");
    if (!playerDiv) return;

    const name = playerDiv.dataset.p;
    const hc = scoresheetrosters[name] || 0;

    if (!flip) {
        document.getElementById("lagWinner").value = name;
        document.getElementById("pA_hc").value = hc;
        document.getElementById("lagWinnerHeader").textContent = name;
    } else {
        document.getElementById("lagLoser").value = name;
        document.getElementById("pB_hc").value = hc;
        document.getElementById("lagLoserHeader").textContent = name;
    }

    flip = !flip;
    saveNow();
});

// 4. Scoring UI Update
function updateScoreUI() {
    const hScore = document.getElementById("homeScore");
    const aScore = document.getElementById("awayScore");
    if (hScore && aScore) {
        hScore.textContent = scores.home;
        aScore.textContent = scores.away;
    }
}

// 5. Stat Increment/Decrement
function changeInnings(amount) {
    let input = document.getElementById("matchInnings");
    input.value = Math.max(0, (parseInt(input.value) || 0) + amount);
    saveNow();
}

function changeWinsA(amount) {
    let input = document.getElementById("pA_wins");
    input.value = Math.max(0, (parseInt(input.value) || 0) + amount);
    document.getElementById('pA_coach').checked = false;
    document.getElementById('pB_coach').checked = false;
    updateMatchWinner();
    saveNow();
}

function changeWinsB(amount) {
    let input = document.getElementById("pB_wins");
    input.value = Math.max(0, (parseInt(input.value) || 0) + amount);
    document.getElementById('pA_coach').checked = false;
    document.getElementById('pB_coach').checked = false;
    updateMatchWinner();
    saveNow();
}

// Utility functions for other stats
function changePASafeties(amount) { let input = document.getElementById("pA_safeties"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); saveNow(); }
function changePA8B(amount) { let input = document.getElementById("pA_b8"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); saveNow(); }
function changePABR(amount) { let input = document.getElementById("pA_br"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); saveNow(); }
function changePAHC(amount) { let input = document.getElementById("pA_hc"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); updateMatchWinner(); saveNow(); }
function changePAE8(amount) { let input = document.getElementById("pA_e8"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); saveNow(); }
function changePBHC(amount) { let input = document.getElementById("pB_hc"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); updateMatchWinner(); saveNow(); }
function changePBsafeties(amount) { let input = document.getElementById("pB_safeties"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); saveNow(); }
function changePB8B(amount) { let input = document.getElementById("pB_b8"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); saveNow(); }
function changePBBR(amount) { let input = document.getElementById("pB_br"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); saveNow(); }
function changePBE8(amount) { let input = document.getElementById("pB_e8"); input.value = Math.max(0, (parseInt(input.value) || 0) + amount); saveNow(); }

// 6. Match Winner Logic
function updateMatchWinner() {
    const aWins = parseInt(document.getElementById("pA_wins").value) || 0;
    const bWins = parseInt(document.getElementById("pB_wins").value) || 0;
    const aHC = parseInt(document.getElementById("pA_hc").value) || 0;
    const bHC = parseInt(document.getElementById("pB_hc").value) || 0;
    const winField = document.getElementById("matchWinner");
    const subBtn = document.getElementById("submitMatch");

    if (aWins === aHC && aHC > 0) {
        winField.value = document.getElementById("lagWinner").value;
    } else if (bWins === bHC && bHC > 0) {
        winField.value = document.getElementById("lagLoser").value;
    } else {
        winField.value = "";
    }
    subBtn.style.display = winField.value ? "inline-block" : "none";
}

// 7. Submit to Google Sheets (Updated to NOT reset teams)
document.getElementById("submitMatch").onclick = function() {
    const btn = this;
    btn.disabled = true;
    btn.style.opacity = "0.5";
    alert("Please wait while your results are submitted...");

    const data = {
        team: document.getElementById("team").value,
        opponent: document.getElementById("opponent").value,
        lagWinner: document.getElementById("lagWinner").value,
        lagLoser: document.getElementById("lagLoser").value,
        matchInnings: document.getElementById("matchInnings").value,
        pA: {
            handicap: document.getElementById("pA_hc").value,
            wins: document.getElementById("pA_wins").value,
            safeties: document.getElementById("pA_safeties").value,
            b8: document.getElementById("pA_b8").value,
            br: document.getElementById("pA_br").value,
            e8: document.getElementById("pA_e8").value
        },
        pB: {
            handicap: document.getElementById("pB_hc").value,
            wins: document.getElementById("pB_wins").value,
            safeties: document.getElementById("pB_safeties").value,
            b8: document.getElementById("pB_b8").value,
            br: document.getElementById("pB_br").value,
            e8: document.getElementById("pB_e8").value
        },
        matchWinner: document.getElementById("matchWinner").value,
        matchNotes: document.getElementById("matchNotes").value
    };

    fetch("https://script.google.com/macros/s/AKfycbxjPd21vbwaqtxnDHyiwq-232S6vxdG-t6JPd2nQrdi9bbH8EakOr4S_11jDF9uvu4/exec", {
        method: "POST",
        mode: "no-cors", 
        body: JSON.stringify(data)
    })
    .then(() => {
        // --- SAVE TO HISTORY ---
        const history = JSON.parse(localStorage.getItem("matchHistory")) || [];
        history.push(data); 
        localStorage.setItem("matchHistory", JSON.stringify(history));

        // --- Update Team Scores ---
        const winnerName = document.getElementById("matchWinner").value;
        const homeTeamName = document.getElementById("team").value;
        const homeRoster = scoresheetinfo[homeTeamName] || [];

        if (homeRoster.includes(winnerName)) {
            scores.home++;
        } else {
            scores.away++;
        }

        // --- Auto-Reset Nightly Score if 5 matches reached ---
        if ((scores.home + scores.away) >= 5) {
            alert(`Match night complete! Final Score: ${scores.home} - ${scores.away}. Resetting session.`);
            scores = { home: 0, away: 0 };
            localStorage.removeItem("matchHistory"); // Optional: clear history automatically after 5 games
        }

        localStorage.setItem("teamMatchScores", JSON.stringify(scores));
        updateScoreUI();

        // --- RESET PLAYER FIELDS ONLY ---
        const fieldsToReset = [
            "lagWinner", "lagLoser", "matchInnings", "matchWinner",
            "pA_hc", "pA_wins", "pA_safeties", "pA_b8", "pA_br", "pA_e8",
            "pB_hc", "pB_wins", "pB_safeties", "pB_b8", "pB_br", "pB_e8"
        ];

        fieldsToReset.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = el.type === "number" ? 0 : "";
        });

        document.getElementById("lagWinnerHeader").textContent = "Lag Winner";
        document.getElementById("lagLoserHeader").textContent = "Lag Loser";
        document.getElementById("matchNotes").value = "-";
        document.getElementById('pA_coach').checked = false;
        document.getElementById('pB_coach').checked = false;

        btn.style.display = "none";
        btn.disabled = false;
        btn.style.opacity = "1";

        saveNow();
        alert("Match submitted and saved to history!");
    })
    .catch(err => {
        alert("Error submitting match. Please try again.");
        btn.disabled = false;
        btn.style.opacity = "1";
    });
};
// 8. Save/Load Logic
function saveNow() {
    if (isLoading) return;
    const ids = ["team","opponent","lagWinner","lagLoser","matchInnings","matchWinner","pA_hc","pA_wins","pA_safeties","pA_b8","pA_br","pA_e8","pB_hc","pB_wins","pB_safeties","pB_b8","pB_br","pB_e8","pA_coach","pB_coach","matchNotes"];
    const data = {};
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) data[id] = el.type === "checkbox" ? el.checked : el.value;
    });
    localStorage.setItem(FORM_KEY, JSON.stringify(data));
}

function loadScoresheet() {
    const raw = localStorage.getItem(FORM_KEY);
    if (!raw) return;
    isLoading = true;
    const data = JSON.parse(raw);
    Object.keys(data).forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            if (el.type === "checkbox") el.checked = data[id];
            else el.value = data[id];
        }
    });
    updateRoster(document.getElementById("team"), document.getElementById("teamRoster"));
    updateRoster(document.getElementById("opponent"), document.getElementById("opponentRoster"));
    updateMatchWinner();
    isLoading = false;
}

// 9. Extra UI Helpers
function exportScoresheet() {
    const data = localStorage.getItem(FORM_KEY);
    if (!data) return alert("No data to transfer.");
    const baseUrl = window.location.href.split('?')[0];
    const fullUrl = `${baseUrl}?data=${encodeURIComponent(data)}`;
    document.getElementById('qrModal').style.display = 'flex';
    document.getElementById('qrcode').innerHTML = '';
    new QRCode(document.getElementById('qrcode'), { text: fullUrl, width: 256, height: 256 });
}

function closeQRModal() { document.getElementById('qrModal').style.display = 'none'; }
function toggleNotes() { const box = document.getElementById("notesContainer"); box.style.display = box.style.display === "none" ? "block" : "none"; }

let timerInterval, seconds = 0;
function startTimer() {
    seconds = 0;
    document.getElementById("timerBox").style.display = "block";
    clearInterval(timerInterval);
    timerInterval = setInterval(() => { seconds++; updateTimerDisplay(); }, 1000);
}
function closeTimer() { clearInterval(timerInterval); document.getElementById("timerBox").style.display = "none"; }
function updateTimerDisplay() {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    document.getElementById("timerValue").textContent = `${mins}:${secs < 10 ? '0' + secs : secs}`;
}

// 10. Initialization
window.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    if (params.has("data")) {
        localStorage.setItem(FORM_KEY, decodeURIComponent(params.get("data")));
        window.history.replaceState({}, document.title, window.location.pathname);
    }
    loadScoresheet();
    updateScoreUI();
});
        // Function to show the history modal
function showHistory() {
    const history = JSON.parse(localStorage.getItem("matchHistory")) || [];
    const tbody = document.getElementById("historyTableBody");
    
    if (history.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">No matches submitted yet.</td></tr>';
    } else {
        tbody.innerHTML = history.map((m, index) => `
            <tr style="border-bottom: 1px solid #333;">
                <td style="padding:10px;">
                    <div style="font-weight:bold; color:#4af;">Match ${index + 1}</div>
                    ${m.lagWinner} vs ${m.lagLoser}
                </td>
                <td style="padding:10px; text-align:center;">
                    ${m.pA.wins}-${m.pB.wins}<br>
                    <small style="color:#0f0;">Winner: ${m.matchWinner}</small>
                </td>
                <td style="padding:10px; text-align:center;">${m.matchInnings}</td>
            </tr>
        `).join("");
    }
    document.getElementById("historyModal").style.display = "flex";
}

function closeHistory() { document.getElementById("historyModal").style.display = "none"; }

function clearHistory() {
    if(confirm("Clear all match history for this evening?")) {
        localStorage.removeItem("matchHistory");
        showHistory();
    }
}
</script>
    <div id="historyModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:10000;">
  <div style="background:#222; padding:20px; border-radius:8px; width:95%; max-width:600px; max-height:80vh; overflow-y:auto; border: 2px solid #1e90ff;">
    <h3 style="text-align:center; color:#1e90ff;">Match History</h3>
    <table style="width:100%; border-collapse: collapse; color: white; font-size: 14px;">
      <thead>
        <tr style="border-bottom: 2px solid #444;">
          <th style="padding:8px; text-align:left;">Match</th>
          <th style="padding:8px; text-align:center;">Result</th>
          <th style="padding:8px; text-align:center;">Inn.</th>
        </tr>
      </thead>
      <tbody id="historyTableBody">
        </tbody>
    </table>
    <div style="text-align:center; margin-top:20px; display:flex; gap:10px; justify-content:center;">
      <button onclick="closeHistory()" style="padding:10px 20px;">Close</button>
      <button onclick="clearHistory()" style="padding:10px 20px; background:crimson; color:white; border:none; border-radius:4px;">Reset History</button>
    </div>
  </div>
</div>
</body>
</html>
