<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player Stats</title>
<script src="playerData.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background-color: #000;
}
footer { text-align: center; padding: 20px; }
  .footer-logo { max-width: 200px; height: auto; }
h1 {
  text-align: center;
  color: #4af;
  font-size: 36px;
}

/* SEARCH BOX */
.search-box {
  display: flex;
  flex-direction: column;
  align-items: stretch;   /* ðŸ”‘ FIX */
  margin-top: 35px;
}

input[type="text"] {
  width: 80%;
  font-size: 22px;
  margin: 20px auto 0 auto;
}

/* AUTOCOMPLETE */
.autocomplete-items:empty {
  display: none;
}

.autocomplete-items {
  width: 80%;             /* ðŸ”‘ FIX */
  margin: 0 auto;
}

.autocomplete-items div {
  background-color: #fff;
  color: #000;
  width: 100%;
  font-size: 22px;
  cursor: pointer;
}

.autocomplete-items div:hover {
  background-color: #e9e9e9;
}

/* STATS BOX */
.stats-box {
  max-width: 800px;
  margin: 20px auto;
  background-color: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  overflow-x: auto;
}

table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  text-align: left;
  padding: 8px;
  border-bottom: 1px solid #ddd;
}

th {
  background-color: #222;
  color: white;
  position: sticky;
  top: 0;
}

/* MODAL */
#statModal {
  display: none;
  position: fixed;
  inset: 0;
  background-color: #000;
  z-index: 1000;
  color: white;
}

#statModalContent {
  max-width: 900px;
  margin: 60px auto;
  padding: 20px;
  border-radius: 10px;
  overflow-x: auto;
}

/* BUTTON */
.back-button {
  display: block;
  padding: 8px 16px;
  background-color: #4af;
  color: #fff;
  border-radius: 6px;
  text-decoration: none;
  font-size: 22px;
  text-align: center;
  height: 30px;
}
  .col-left {
  text-align: left;
}

.col-center {
  text-align: center;
}

.col-right {
  text-align: right;
}
</style>
</head>
  <body>

<!-- MODAL -->
<div id="statModal">
  <div id="statModalContent">
    <h2 id="modalTitle"></h2>
    <table id="modalTable" style="width:100%; border-collapse:collapse;"></table>

    <div class="search-box">
      <button onclick="closeModal()" style="
        margin-top:20px;
        padding:10px 20px;
        font-size:18px;
        cursor:pointer;
        background-color:#4af;
        color:#000;
      ">Close</button>
    </div>
  </div>
</div>

<h1>Player Stats</h1>

<!-- SEARCH -->
<div class="search-box">
  <input id="playerInput" type="text" placeholder="Type player name...">
  <div id="autocomplete-list" class="autocomplete-items"></div>
</div>

<!-- STATS -->
<div class="stats-box" id="statsBox" style="display:none;">
  <h2 id="playerName"></h2>
  <table id="statsTable" style="background-color:#D3D3D3;"></table>
</div>

<script>
function closeModal() {
  document.getElementById('statModal').style.display = 'none';
}

// AUTOCOMPLETE LOGIC (fixed)
const input = document.getElementById('playerInput');
const list = document.getElementById('autocomplete-list');

input.addEventListener('input', function () {
  const val = this.value.toLowerCase();
  list.innerHTML = '';
  if (!val) return;

  const matches = playerData
    .map(p => p["Player Name"])
    .filter(name => name.toLowerCase().startsWith(val))
    .sort((a, b) => a.localeCompare(b));

  matches.forEach(name => {
    const item = document.createElement('div');
    item.textContent = name;

    const playerObj = playerData.find(p => p["Player Name"] === name);
    item.addEventListener('click', () => selectPlayer(playerObj));

    list.appendChild(item);
  });
});

function selectPlayer(player) {
  // Show player name + handicap in the header
  document.getElementById('playerName').textContent = `${player["Player Name"]} - HC ${player["Handicap"]}`;
  
  const table = document.getElementById('statsTable');
  table.innerHTML = '';
  
  // Display all stats except Player Name and Handicap (since we now show it in the title)
  for (const key in player) {
    if (key === "Player Name" || key === "Handicap") continue;
    const row = document.createElement('tr');row.style.cursor = 'pointer';row.addEventListener('click', () => showTop10(key));
    const cellKey = document.createElement('th');
    cellKey.textContent = key;
    const cellVal = document.createElement('td');
    cellVal.textContent = player[key];
    row.appendChild(cellKey);
    row.appendChild(cellVal);
    table.appendChild(row);
  }

  document.getElementById('statsBox').style.display = 'block';
  list.innerHTML = '';
  input.value = '';
}
  

function showTop10(statKey) {

  // Stats where LOWER is better
  const lowerIsBetter = [
    "Life Hash",
    "White Washed"
  ];

  // Stats requiring minimum Matches Played
  const minMPRequiredStats = [
    "Match Win %",
    "Game Win%",
    "Life Hash",
    "% Weeks w/8OB, BR or Rackless",
    "White Washed"
  ];

  const ranked = playerData
    .filter(p => {
      // Enforce 25 MP rule ONLY for specific stats
      if (minMPRequiredStats.includes(statKey)) {
        return p["Matches Played"] >= 25;
      }
      return true;
    })
    .map(p => {
      let raw = p[statKey];

      // Normalize value
      let value = parseFloat(
        typeof raw === "string"
          ? raw.replace('%', '')
          : raw
      );

      return {
        name: p["Player Name"],
        value
      };
    })
    // FINAL sanity filter â€” guarantees clean sorting
    .filter(p => Number.isFinite(p.value))
    .sort((a, b) => {
      return lowerIsBetter.includes(statKey)
        ? a.value - b.value   // ASC
        : b.value - a.value;  // DESC
    })
    .slice(0, 10);

  document.getElementById('modalTitle').textContent =
  `Top 10 â€“ ${statKey}` +
  (minMPRequiredStats.includes(statKey) ? " (Min 25 MP)" : "");


  const table = document.getElementById('modalTable');

table.innerHTML = `
<tr>
  <th class="col-rank">Rank</th>
  <th class="col-player">Player</th>
  <th class="col-stat">${statKey}</th>
</tr>
${ranked.slice(0, 10).map((p, i) => `
<tr>
  <td class="col-center">${i + 1}</td>
  <td class="col-left">${p.name}</td>
  <td class="col-center">${p.value}</td>
</tr>`).join('')}
`;
  document.getElementById('statModal').style.display = 'block';
}
  function openModal(data) {
    console.log("Modal Opened!", data); // Troubleshooting line
    
    const modal = document.getElementById("statModal");
    const title = document.getElementById("modalTitle");
    
    title.innerText = "Player Details";
    modal.style.display = "block";


</script>

  <a class="back-button" style="margin-top:50px;" href="index.html">Main Menu</a>
<footer>
    <img src="white transparent.png" style="margin-top:35px" alt="League Logo" class="footer-logo">
</footer>
</body>
</html>
